# Scripting mechanism

用户选择了信赖的 Hive Node 并订阅了 Vault Service 作为文件或数据的存储中心，正常情况下其它的用户无法访问 Vault 数据，确保 Vault 数据仅被拥有者访问是 Hive Node的核心特性之一。实际的应用场景中，用户需要存储私有的数据，或者存储公开给特定用户访问的数据。比如：用户的应用配置信息是私有的，但用户通过博客分享给他人的文件或者消息则是公有的，当然分享的信息也可能是完全公开的。为了支持分享数据的特性，Hive Node 提供了scripting机制。

Vault 数据的拥有者通过 scripting 机制定义脚本（Script），指定了需要分享的数据和分享到的人，相当于定义了一个给数据数据访问者获取的通道。数据的访问者则通过访问特定用户的脚本来获取数据，能否成功访问到数据取决于他是否拥有数据的访问权限。

## Executable

用户订阅来自 Hive Node 的 Vault Service，就是为了能使用 Vault 的数据服务。Vault 基础的数据服务有两项：文件和数据库数据服务。当用户通过脚本分享数据的时实际上就是分享数据服务的操作权（不仅仅是查看数据），脚本为此设计了不同的类型，这些类型包括数据库的增删查改、文件的上传下载、文件属性和 Hash 值的获取。设计的这些类型能满足用户分享数据的需求。

同时为了限制用户只能操作指定的数据，比如：特定的数据库字段和指定文件的路径，允许用户在脚本里设计自定义参数。如果将类型比做用户定义的函数，那么自定义参数，就是对应函数的参数。

脚本的参数和类型被包装在脚本的 Executable（执行体）里面，作为脚本的组成部分之一。当然一个脚本可以包含多个执行体，它们用名称分开，这样可以在执行脚本的时候获取对应的返回值。

## Condition

脚本中的 Condition 用于过滤数据的访问者，它设计的规则比较简单，定义为某个用户定义的数据库中能查到某些数据即可认为是符合条件的，至于是什么表的什么数据，需要数据的拥有者自己定义。通常数据的拥有者会将这个表设计为权限表，当访问者在这个表中并拥有某个权限的时候，条件即会满足。

数据的访问者在执行脚本的时候，需要提供一些信息，以证明自己拥有权限。否则，脚本将无法执行。

## Anonymous

数据拥有者定义的脚本，除了按 Condition 来限制数据的访问者，还支持匿名参数。匿名参数分两种：用户匿名和应用匿名。用户匿名就是不限制用户的 DID，应用匿名就是不限制应用的 DID。若用户和应用都设置了匿名，那么用户脚本对应的数据就完全公开，此时可以看作，用户试图分享一些完全公开的数据，无论什么应用和用户都可以访问。

Hive Node 的文件存储是基于 IPFS，意味着文件的分享可以基于 IPFS 代理进行。Hive Node 背后是一个 IPFS 节点的网络，存储于 IPFS 节点上的文件，可以通过连接它的 IPFS 代理访问到。基于 IPFS 代理访问文件也是匿名分享的方式之一。
